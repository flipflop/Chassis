require.def("xhr-spy/xhr",["core/lib"],function(a){function h(){this.requestHeaders=[],this.responseHeaders=[]}var b=function(b){function n(){var e=b.readyState;d.readyState=e;var f=new Date;e==1?c.startedDateTime=f:e==2?c.timings.send=f:e==3?c.timings.receive=f:e==4&&(l(),b.onreadystatechange=function(){},c.time=f-c.startedDateTime,c.timings.receive=f-c.timings.send,c.timings.send=c.timings.send-c.startedDateTime,c.startedDateTime=a.toISOString(c.startedDateTime))}function m(a,b){var c=a.getAllResponseHeaders(),d=c?c.split(/[\n\r]/):[],e=/^(\S+):\s*(.*)/;for(var f=0,g=d.length;f<g;f++){var h=d[f],i=h.match(e);if(i){var j=i[1],k=i[2];j=="Content-Type"&&(b.response.mimeType=k),b.response.headers.push({name:[j],value:[k]})}}}function l(){c.response.status=b.status,c.response.statusText=b.statusText;var d=(new Date).getTime()-g,e=b.status==200;m(b,c),setTimeout(function(){var d=b.responseText;c.response.content.text=d,c.response.content.size=d,c.response.bodySize=d?d.length:0,a.removeClass(c.logRow,"loading"),e||a.setClass(c.logRow,"error"),k()},200),c.loaded=!0}function k(){c.logRow=c.log(),a.setClass(c.logRow,"loading")}function j(){for(var a in d)try{var c=d[a];b[a]||(b[a]=c)}catch(e){}}function i(){for(var c in b)try{var e=b[c];a.isFunction(e)||(d[c]=e)}catch(f){}}var b=b,c=new h,d=this,e,f,g;this.readyState=0,this.onreadystatechange=function(){},this.open=function(d,e,f,g,h){c.request.method=d,c.request.url=e,c.async=f,c.request.queryString=a.parseURLParams(e),!$.browser.msie&&f&&(b.onreadystatechange=n),typeof b.open.apply!="undefined"?b.open.apply(b,arguments):b.open(d,e,f,g,h),$.browser.msie&&f&&(b.onreadystatechange=n)},this.send=function(a){c.request.postData.text=a,j();try{b.send(a)}catch(e){throw e}finally{c.async||(d.readyState=b.readyState,l())}},this.setRequestHeader=function(a,d){c.requestHeaders.push({name:[a],value:[d]});return b.setRequestHeader(a,d)},this.getResponseHeader=function(a){return b.getResponseHeader(a)},this.getAllResponseHeaders=function(){return b.getAllResponseHeaders()},this.abort=function(){return b.abort()};var o=b.open&&typeof b.open.apply!="undefined";for(var p in b){if(p=="onreadystatechange")continue;try{var q=b[p];a.isFunction(q)?typeof d[p]=="undefined"&&(this[p]=o?function(){return b[p].apply(b,arguments)}:function(a,c,d,e,f){return b[p](a,c,d,e,f)}):this[p]=q}catch(r){}}return this},c=window.parent,d=/msie 6/i.test(navigator.appVersion);if(d){var f=" MSXML2.XMLHTTP.5.0 MSXML2.XMLHTTP.4.0 MSXML2.XMLHTTP.3.0 MSXML2.XMLHTTP Microsoft.XMLHTTP ",g=c.ActiveXObject;c.ActiveXObject=function(a){try{var d=new c._ActiveXObject(a);return f.indexOf(" "+a+" ")!=-1?new b(d):d}catch(e){}}}else{var e=c.XMLHttpRequest;c.XMLHttpRequest=function(){return new b(new e)}}h.prototype={async:null,href:null,loaded:!1,logRow:null,responseText:null,requestHeaders:null,responseHeaders:null,sourceLink:null,startedDateTime:null,response:{headers:[],content:{text:""}},request:{url:"",method:"",bodySize:0,headers:[],postData:{}},timings:{dns:-1,connect:-1,blocked:-1,send:-1,wait:-1,receive:-1,ssl:-1,comment:-1,connect:-1},getURL:function(){return this.href},log:function(){}};return h})